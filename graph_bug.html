<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Graph bug</title>
    <script>
      function runtest() {
        let points = [
          [242.28260869565216, 64.11111111111111],
          [242.58799171842648, 64.11111111111111],
          [242.8933747412008, 61],
          [243.50414078674947, 61],
          [243.8095238095238, 61],
          [244.11490683229812, 57.888888888888886],
          [244.42028985507244, 57.888888888888886],
          [244.7256728778468, 57.888888888888886],
          [245.0310559006211, 57.888888888888886],
          [245.33643892339543, 61],
          [245.64182194616976, 57.888888888888886],
          [245.94720496894408, 57.888888888888886],
          [246.2525879917184, 57.888888888888886],
          [246.55797101449275, 61],
          [246.86335403726707, 61],
          [247.1687370600414, 61],
          [247.47412008281572, 57.888888888888886],
          [247.77950310559004, 61],
          [248.0848861283644, 61],
          [248.3902691511387, 61],
          [248.69565217391303, 61],
          [249.00103519668735, 61],
          [249.30641821946168, 61],
          [249.611801242236, 61],
          [249.91718426501035, 64.11111111111111],
          [250.22256728778467, 64.11111111111111],
          [250.527950310559, 64.11111111111111],
          [250.83333333333331, 64.11111111111111],
          [251.13871635610764, 64.11111111111111],
          [251.444099378882, 64.11111111111111],
          [251.7494824016563, 64.11111111111111],
          [252.05486542443063, 64.11111111111111],
          [252.36024844720495, 64.11111111111111],
          [252.66563146997927, 64.11111111111111],
          [252.9710144927536, 61],
          [253.27639751552795, 64.11111111111111],
          [253.58178053830227, 64.11111111111111],
          [253.8871635610766, 64.11111111111111],
          [254.1925465838509, 64.11111111111111],
          [254.49792960662523, 64.11111111111111],
          [254.80331262939958, 64.11111111111111],
          [255.1086956521739, 64.11111111111111],
          [255.41407867494823, 64.11111111111111],
          [255.71946169772255, 64.11111111111111],
          [256.02484472049684, 61],
          [256.33022774327117, 61],
          [256.63561076604555, 61],
          [256.94099378881987, 64.11111111111111],
          [257.2463768115942, 61],
          [257.5517598343685, 61],
          [257.85714285714283, 64.11111111111111],
          [258.1625258799172, 64.11111111111111],
          [258.46790890269153, 64.11111111111111],
          [258.77329192546586, 64.11111111111111],
          [259.0786749482402, 64.11111111111111],
          [259.3840579710145, 61],
          [259.6894409937888, 61],
          [259.99482401656314, 61],
          [260.30020703933747, 64.11111111111111],
          [260.6055900621118, 64.11111111111111],
          [260.9109730848861, 64.11111111111111],
          [261.21635610766043, 64.11111111111111],
          [261.52173913043475, 64.11111111111111],
          [261.8271221532091, 64.11111111111111],
          [262.1325051759834, 61],
          [262.4378881987578, 61],
          [262.7432712215321, 67.22222222222221],
          [263.0486542443064, 67.22222222222221],
          [263.35403726708074, 73.44444444444444]
        ];
        drawPoly('green',consolodate(points));
      }
      const height = 150;
      const margins = [5,5,5,5];
      function drawPoly(colour,points) {
        const canvas = document.getElementById('graph');
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = colour;
        ctx.beginPath();
        ctx.moveTo(points[0][0], height - margins[2]);
        points.forEach(p => {
          ctx.lineTo(p[0],p[1]);
        });
        ctx.lineTo(points[points.length - 1][0], height - margins[2]);
        ctx.closePath();
        ctx.fill();
        //ctx.stroke();
      }
      function consolodate(array) {
        const newArray = [];
        array.forEach(x => {
          const entry = [Math.round(x[0]),x[1]];
          if (newArray.length === 0 || newArray[newArray.length - 1][0] !== entry[0]) {
            newArray.push(entry);
          }
          newArray[newArray.length - 1][1] = Math.max(newArray[newArray.length - 1][1], entry[1]);
        });
        return newArray;
      }
    </script>
  </head>
  <body onload="runtest()">
    <canvas id="graph" width="600" height="150"></canvas>
  </body>
</html>